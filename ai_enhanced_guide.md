# ç¼ è®ºAIå¢å¼ºåˆ†æåŠŸèƒ½å®Œæ•´æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†å¦‚ä½•æ„å»ºå’Œä½¿ç”¨èåˆæœ¬åœ°çŸ¥è¯†åº“çš„ç¼ è®ºAIåˆ†æåŠŸèƒ½ã€‚è¯¥åŠŸèƒ½é€šè¿‡æ•´åˆä¸“ä¸šçš„ç¼ è®ºçŸ¥è¯†åº“ï¼Œä¸ºAIåˆ†ææä¾›æ›´å‡†ç¡®ã€æ›´ä¸“ä¸šçš„å¸‚åœºåˆ†æå»ºè®®ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

### ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿
- **çŸ¥è¯†åº“å¢å¼º**: èåˆä¸“ä¸šç¼ è®ºç†è®ºçŸ¥è¯†ï¼Œæä¾›æ›´å‡†ç¡®çš„åˆ†æ
- **æ™ºèƒ½æ£€ç´¢**: åŸºäºTF-IDFå’Œä½™å¼¦ç›¸ä¼¼åº¦çš„æ™ºèƒ½çŸ¥è¯†åŒ¹é…
- **åˆ†ç±»ç®¡ç†**: æ”¯æŒæŒ‰ç±»åˆ«ç»„ç»‡å’Œæ£€ç´¢çŸ¥è¯†å†…å®¹
- **çµæ´»é…ç½®**: æ”¯æŒå¤šç§åˆ†æç±»å‹å’ŒçŸ¥è¯†åº“é…ç½®
- **å…¼å®¹æ€§å¼º**: å®Œå…¨å…¼å®¹ç°æœ‰ç¼ è®ºåˆ†ææ¡†æ¶

### ğŸ“Š æ”¯æŒçš„åˆ†æç±»å‹
- **ç»¼åˆåˆ†æ** (comprehensive): å…¨é¢çš„å¸‚åœºåˆ†æ
- **äº¤æ˜“åˆ†æ** (trading): ä¸“æ³¨äºä¹°å–ç‚¹å’Œäº¤æ˜“ç­–ç•¥
- **é£é™©åˆ†æ** (risk): é‡ç‚¹å…³æ³¨é£é™©æ§åˆ¶å’Œå¸‚åœºå¿ƒç†
- **é€‰è‚¡åˆ†æ** (selection): è‚¡ç¥¨é€‰æ‹©å’Œæ¿å—åˆ†æ

## ç³»ç»Ÿæ¶æ„

```
ç¼ è®ºAIå¢å¼ºåˆ†æç³»ç»Ÿ
â”œâ”€â”€ çŸ¥è¯†åº“æ¨¡å— (KnowledgeBase)
â”‚   â”œâ”€â”€ æ–‡æ¡£å­˜å‚¨ä¸ç®¡ç†
â”‚   â”œâ”€â”€ TF-IDFå‘é‡åŒ–
â”‚   â”œâ”€â”€ ç›¸ä¼¼åº¦è®¡ç®—
â”‚   â””â”€â”€ åˆ†ç±»æ£€ç´¢
â”œâ”€â”€ å¢å¼ºåˆ†ææ¨¡å— (AIAnalyseEnhanced)
â”‚   â”œâ”€â”€ çŸ¥è¯†åº“é›†æˆ
â”‚   â”œâ”€â”€ æ™ºèƒ½æç¤ºè¯ç”Ÿæˆ
â”‚   â”œâ”€â”€ å¤šæ¨¡å‹æ”¯æŒ
â”‚   â””â”€â”€ åˆ†æç»“æœä¼˜åŒ–
â””â”€â”€ é›†æˆæœåŠ¡æ¨¡å— (EnhancedAnalysisService)
    â”œâ”€â”€ ç»Ÿä¸€æ¥å£
    â”œâ”€â”€ æ‰¹é‡å¤„ç†
    â”œâ”€â”€ æ–¹æ³•æ¯”è¾ƒ
    â””â”€â”€ çŠ¶æ€ç›‘æ§
```

## å®‰è£…ä¸é…ç½®

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
conda activate quant

# å®‰è£…ä¾èµ–åŒ…
pip install jieba scikit-learn MyTT

# å¦‚æœéœ€è¦ä½¿ç”¨talibï¼ˆå¯é€‰ï¼‰
# brew install ta-lib  # macOS
# pip install TA-Lib
```

### 2. æ ¸å¿ƒæ–‡ä»¶

é¡¹ç›®åŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ–‡ä»¶ï¼š

- `src/chanlun/tools/knowledge_base.py` - çŸ¥è¯†åº“ç®¡ç†ç±»
- `src/chanlun/tools/ai_analyse_enhanced.py` - å¢å¼ºAIåˆ†æç±»
- `integration_example.py` - é›†æˆä½¿ç”¨ç¤ºä¾‹
- `example_enhanced_analysis.py` - åŠŸèƒ½æ¼”ç¤ºç¤ºä¾‹
- `test_enhanced_ai.py` - åŠŸèƒ½æµ‹è¯•è„šæœ¬

### 3. APIé…ç½®

åœ¨ä½¿ç”¨AIåˆ†æåŠŸèƒ½å‰ï¼Œéœ€è¦é…ç½®ç›¸åº”çš„APIå¯†é’¥ï¼š

```python
# åœ¨ src/chanlun/config.py ä¸­é…ç½®
OPENROUTER_API_KEY = "your_openrouter_api_key"
SILICONFLOW_API_KEY = "your_siliconflow_api_key"
```

## ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ä½¿ç”¨

```python
from chanlun.tools.ai_analyse_enhanced import AIAnalyseEnhanced

# åˆå§‹åŒ–å¢å¼ºåˆ†æå™¨
ai_analyser = AIAnalyseEnhanced("a", "my_knowledge_base")

# æ·»åŠ è‡ªå®šä¹‰çŸ¥è¯†
ai_analyser.add_knowledge(
    "ä¸€ä¹°ç‚¹è¯†åˆ«æŠ€å·§",
    "ä¸€ä¹°ç‚¹å‡ºç°åœ¨ä¸‹è·Œè¶‹åŠ¿çš„æœ€åé˜¶æ®µï¼Œé€šå¸¸ä¼´éšç€èƒŒé©°ä¿¡å·...",
    "ä¹°å–ç‚¹å®æˆ˜"
)

# æ‰§è¡Œå¢å¼ºåˆ†æ
result = ai_analyser.analyse_with_knowledge(
    code="000001",
    frequency="30m",
    use_knowledge=True,
    knowledge_categories=["ä¹°å–ç‚¹å®æˆ˜", "æŠ€æœ¯åˆ†æ"]
)
```

### é«˜çº§ä½¿ç”¨ - é›†æˆæœåŠ¡

```python
from integration_example import EnhancedAnalysisService

# åˆå§‹åŒ–æœåŠ¡
service = EnhancedAnalysisService("a", "production_kb")

# å•è‚¡åˆ†æ
result = service.analyze_stock(
    code="000001",
    frequency="30m",
    use_enhanced=True,
    analysis_type="trading"
)

# æ‰¹é‡åˆ†æ
batch_result = service.batch_analyze(
    stock_list=["000001", "000002", "600000"],
    frequency="30m"
)

# æ–¹æ³•æ¯”è¾ƒ
comparison = service.compare_analysis_methods("000001", "30m")
```

## çŸ¥è¯†åº“ç®¡ç†

### çŸ¥è¯†åˆ†ç±»ä½“ç³»

ç³»ç»Ÿæ”¯æŒä»¥ä¸‹çŸ¥è¯†åˆ†ç±»ï¼š

- **ä¹°å–ç‚¹å®æˆ˜**: å®é™…äº¤æ˜“ä¸­çš„ä¹°å–ç‚¹è¯†åˆ«å’Œåº”ç”¨
- **ä¸­æ¢å®æˆ˜**: ä¸­æ¢ç†è®ºçš„å®æˆ˜åº”ç”¨
- **èƒŒé©°å®æˆ˜**: èƒŒé©°ä¿¡å·çš„è¯†åˆ«å’Œåº”ç”¨
- **çº¿æ®µå®æˆ˜**: çº¿æ®µåˆ†æçš„å®æˆ˜æŠ€å·§
- **æŠ€æœ¯æŒ‡æ ‡å®æˆ˜**: æŠ€æœ¯æŒ‡æ ‡ä¸ç¼ è®ºçš„ç»“åˆåº”ç”¨
- **é£é™©ç®¡ç†**: é£é™©æ§åˆ¶å’Œèµ„é‡‘ç®¡ç†
- **å¸‚åœºå¿ƒç†**: å¸‚åœºæƒ…ç»ªå’Œå¿ƒç†åˆ†æ
- **é€‰è‚¡ç­–ç•¥**: è‚¡ç¥¨é€‰æ‹©å’Œæ¿å—åˆ†æ

### çŸ¥è¯†åº“æ“ä½œ

```python
# æŸ¥çœ‹çŸ¥è¯†åº“ç»Ÿè®¡
stats = ai_analyser.get_knowledge_stats()
print(f"æ€»æ–‡æ¡£æ•°: {stats['total_documents']}")
print(f"åˆ†ç±»: {stats['categories']}")

# æœç´¢çŸ¥è¯†
results = ai_analyser.search_knowledge(
    query="å¦‚ä½•åˆ¤æ–­ä¸€ä¹°ç‚¹",
    top_k=3,
    category="ä¹°å–ç‚¹å®æˆ˜"
)

# ä¿å­˜çŸ¥è¯†åº“
ai_analyser.save_knowledge_base("backup_kb.json")

# åŠ è½½çŸ¥è¯†åº“
ai_analyser.load_knowledge_base("backup_kb.json")
```

## å·¥ä½œåŸç†

### 1. çŸ¥è¯†æ£€ç´¢æµç¨‹

```
ç”¨æˆ·æŸ¥è¯¢ â†’ æ–‡æœ¬é¢„å¤„ç† â†’ TF-IDFå‘é‡åŒ– â†’ ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®— â†’ æ’åºç­›é€‰ â†’ è¿”å›ç»“æœ
```

### 2. å¢å¼ºåˆ†ææµç¨‹

```
ç¼ è®ºæ•°æ® â†’ æå–å…³é”®ä¿¡æ¯ â†’ çŸ¥è¯†åº“æ£€ç´¢ â†’ èåˆçŸ¥è¯†å†…å®¹ â†’ ç”Ÿæˆå¢å¼ºæç¤ºè¯ â†’ AIåˆ†æ â†’ è¿”å›ç»“æœ
```

### 3. æç¤ºè¯å¢å¼ºç­–ç•¥

- **ä¸Šä¸‹æ–‡èåˆ**: å°†ç›¸å…³çŸ¥è¯†æ— ç¼èå…¥åˆ†æä¸Šä¸‹æ–‡
- **ä¸“ä¸šæœ¯è¯­**: ä½¿ç”¨æ ‡å‡†çš„ç¼ è®ºæœ¯è¯­å’Œæ¦‚å¿µ
- **å®æˆ˜ç»éªŒ**: èå…¥å®é™…äº¤æ˜“ä¸­çš„ç»éªŒå’ŒæŠ€å·§
- **é£é™©æç¤º**: è‡ªåŠ¨æ·»åŠ ç›¸å…³çš„é£é™©æ§åˆ¶å»ºè®®

## æ€§èƒ½ä¼˜åŒ–

### 1. çŸ¥è¯†åº“ä¼˜åŒ–

- **æ–‡æ¡£è´¨é‡**: ç¡®ä¿çŸ¥è¯†å†…å®¹çš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§
- **åˆ†ç±»åˆç†**: åˆç†è®¾ç½®çŸ¥è¯†åˆ†ç±»ï¼Œæé«˜æ£€ç´¢æ•ˆç‡
- **å®šæœŸæ›´æ–°**: æ ¹æ®å¸‚åœºå˜åŒ–æ›´æ–°çŸ¥è¯†å†…å®¹
- **å»é‡å¤„ç†**: é¿å…é‡å¤æˆ–ç›¸ä¼¼çš„çŸ¥è¯†å†…å®¹

### 2. æ£€ç´¢ä¼˜åŒ–

- **å…³é”®è¯æå–**: ä¼˜åŒ–å…³é”®è¯æå–ç®—æ³•
- **ç›¸ä¼¼åº¦é˜ˆå€¼**: åˆç†è®¾ç½®ç›¸ä¼¼åº¦é˜ˆå€¼
- **ç¼“å­˜æœºåˆ¶**: å¯¹å¸¸ç”¨æŸ¥è¯¢ç»“æœè¿›è¡Œç¼“å­˜
- **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡çŸ¥è¯†æ£€ç´¢

## æœ€ä½³å®è·µ

### 1. çŸ¥è¯†åº“å»ºè®¾

```python
# æ¨èçš„çŸ¥è¯†æ·»åŠ æ–¹å¼
knowledge_items = [
    {
        "title": "å…·ä½“æ˜ç¡®çš„æ ‡é¢˜",
        "content": "è¯¦ç»†çš„å†…å®¹æè¿°ï¼ŒåŒ…å«å…·ä½“çš„æ“ä½œæ–¹æ³•å’Œæ³¨æ„äº‹é¡¹",
        "category": "æ˜ç¡®çš„åˆ†ç±»"
    }
]

for item in knowledge_items:
    ai_analyser.add_knowledge(
        item["title"], 
        item["content"], 
        item["category"]
    )
```

### 2. åˆ†æé…ç½®

```python
# æ¨èçš„åˆ†æé…ç½®
analysis_config = {
    "use_knowledge": True,
    "knowledge_categories": ["ä¹°å–ç‚¹å®æˆ˜", "é£é™©ç®¡ç†"],  # æ ¹æ®éœ€æ±‚é€‰æ‹©
    "max_knowledge_docs": 3,  # æ§åˆ¶çŸ¥è¯†æ•°é‡
    "min_similarity": 0.1  # è®¾ç½®ç›¸ä¼¼åº¦é˜ˆå€¼
}
```

### 3. é”™è¯¯å¤„ç†

```python
try:
    result = ai_analyser.analyse_with_knowledge(
        code="000001",
        frequency="30m",
        **analysis_config
    )
    
    if result['ok']:
        print("åˆ†ææˆåŠŸ:", result['msg'])
    else:
        print("åˆ†æå¤±è´¥:", result['msg'])
        
except Exception as e:
    print(f"åˆ†æè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: {e}")
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡å—å¯¼å…¥é”™è¯¯**
   ```bash
   # ç¡®ä¿é¡¹ç›®è·¯å¾„æ­£ç¡®
   export PYTHONPATH="/path/to/chanlun-pro/src:$PYTHONPATH"
   ```

2. **ä¾èµ–åŒ…ç¼ºå¤±**
   ```bash
   pip install jieba scikit-learn MyTT
   ```

3. **çŸ¥è¯†åº“ä¸ºç©º**
   ```python
   # æ£€æŸ¥çŸ¥è¯†åº“çŠ¶æ€
   stats = ai_analyser.get_knowledge_stats()
   if stats['total_documents'] == 0:
       ai_analyser.init_default_knowledge_base()
   ```

4. **APIé…ç½®é—®é¢˜**
   ```python
   # æ£€æŸ¥APIé…ç½®
   from chanlun import config
   print("OpenRouter API:", hasattr(config, 'OPENROUTER_API_KEY'))
   print("SiliconFlow API:", hasattr(config, 'SILICONFLOW_API_KEY'))
   ```

### è°ƒè¯•æŠ€å·§

```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# æ£€æŸ¥çŸ¥è¯†æ£€ç´¢ç»“æœ
results = ai_analyser.search_knowledge("æµ‹è¯•æŸ¥è¯¢")
print(f"æ£€ç´¢åˆ° {len(results)} ä¸ªç›¸å…³çŸ¥è¯†")

# æŸ¥çœ‹ç”Ÿæˆçš„æç¤ºè¯
prompt = ai_analyser.generate_knowledge_enhanced_prompt(
    original_prompt="åŸå§‹æç¤ºè¯",
    knowledge_results=results
)
print("å¢å¼ºåçš„æç¤ºè¯:", prompt)
```

## æ‰©å±•å¼€å‘

### è‡ªå®šä¹‰çŸ¥è¯†æ£€ç´¢ç®—æ³•

```python
class CustomKnowledgeBase(KnowledgeBase):
    def custom_search(self, query, **kwargs):
        # å®ç°è‡ªå®šä¹‰æ£€ç´¢é€»è¾‘
        pass
```

### è‡ªå®šä¹‰åˆ†æç­–ç•¥

```python
class CustomAIAnalyse(AIAnalyseEnhanced):
    def custom_analyse_strategy(self, code, frequency):
        # å®ç°è‡ªå®šä¹‰åˆ†æç­–ç•¥
        pass
```

## æ€»ç»“

é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å·²ç»äº†è§£äº†å¦‚ä½•æ„å»ºå’Œä½¿ç”¨èåˆæœ¬åœ°çŸ¥è¯†åº“çš„ç¼ è®ºAIåˆ†æåŠŸèƒ½ã€‚è¯¥ç³»ç»Ÿæä¾›äº†ï¼š

- âœ… å®Œæ•´çš„çŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½
- âœ… æ™ºèƒ½çš„çŸ¥è¯†æ£€ç´¢æœºåˆ¶
- âœ… çµæ´»çš„åˆ†æé…ç½®é€‰é¡¹
- âœ… æ˜“äºé›†æˆçš„æœåŠ¡æ¥å£
- âœ… è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹

å»ºè®®åœ¨å®é™…ä½¿ç”¨ä¸­ï¼š
1. æ ¹æ®å…·ä½“éœ€æ±‚é…ç½®çŸ¥è¯†åº“å†…å®¹
2. åˆç†é€‰æ‹©åˆ†æç±»å‹å’Œå‚æ•°
3. å®šæœŸæ›´æ–°å’Œä¼˜åŒ–çŸ¥è¯†åº“
4. ç»“åˆå…¶ä»–æŠ€æœ¯æŒ‡æ ‡è¿›è¡Œç»¼åˆåˆ¤æ–­

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–æŸ¥çœ‹ç¤ºä¾‹ä»£ç ã€‚